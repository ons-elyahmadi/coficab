
load("bin/models.RData")

require(tidyverse)
require(forecast)
require(randomForest)
require(ggplot2)
require(reshape2) # for melt function
require(lubridate) # for highlighting dates on graphs

# Get predictions for the 4 types of models. 
simple_LR_copper_pred <- predict(simple_LR_copper, test)
 

ARIMA_copper_pred <- as.numeric(forecast_copper$mean)
 

NN_copper_pred <- data.frame(nn_forecast_copper)
 

RF_copper_pred <-predict(RF_copper, newdata = test)
 

## Let's compare each models' predictions - only for LR and RF

# Model Results Graph 
all_results_copper <- data.frame(predict(simple_LR_copper, data), predict(RF_copper, data), data[2], data[1])
 
copper_melt <- melt(all_results_copper, id = "date")

# Plot results
ggplot() +
      geom_rect(data=data.frame( xmin=(as.Date(c("2019-02-15"))),
                                 xmax=(as.Date(c("2024-03-04"))),
                            ymin=-Inf,
                            ymax=Inf),
            aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
            fill="orange",alpha=0.3) +
      geom_line(data=copper_melt, 
                aes(x=date, y=value, col=variable)) +
      ggtitle("Predictions for Copper") +
      scale_color_discrete(name  ="Models",
                          breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),
                          labels=c("Linear Regression", "Random Forest", "Actual Price")
                          )


 
# Now let's see forecast models
par(mfrow=c(1,2))
plot(forecast_copper, main ="ARIMA Forecast for Copper")
plot(nn_forecast_copper, main ="NN Forecast for Copper")
 
################################
# This part of the script will output csv files with the results of all models

#write.csv(nn_forecast_zinc, "results/nn_results_zinc.csv", row.names = F)
write.csv(nn_forecast_copper, "results/nn_results_copper.csv", row.names = F)
#write.csv(all_results_zinc, "results/all_results_zinc.csv", row.names = F)
write.csv(all_results_copper, "results/all_results_copper.csv", row.names = F)

###### old version of plots with updated legend

ggplot() +  
       geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
       ggtitle("Predictions for Copper") + 
       scale_color_discrete(name  ="Models",
                           breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),                           
                           labels=c("Linear Regression", "Random Forest", "Actual Price") 
                          )

 
library(ggthemes) # Load

ggplot() +  
       geom_line(data=copper_melt, aes(x=date, y=value, col=variable)) +
       ggtitle("Predictions for Copper") + 
       scale_color_discrete(name  ="Models",
                           breaks=c("predict.simple_LR_copper..data.", "predict.RF_copper..data.", "copper_price"),                           
                           labels=c("Linear Regression", "Random Forest", "Actual Price")) +
      geom_rect(data=data.frame( xmin=(as.Date(c("2019-02-15"))),
                                 xmax=(as.Date(c("2024-03-04"))),
                            ymin=-Inf,
                            ymax=Inf),
            aes(xmin=xmin,xmax=xmax,ymin=ymin,ymax=ymax),
            fill="orange",alpha=0.3) +
      xlab("Year") +
      ylab("Price in USD") +
      theme_void()

